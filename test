<?php
session_start();
// fetch_courses.php
require_once '../config/connect.php';
header('Content-Type: application/json');
$semester = $_SESSION['semester'];
$schoolYear = $_SESSION['schoolYear'];

try {
    // Assuming the session variables are already set
    $class_id = $_SESSION['class'];
    $major_id = $_SESSION['major'];

    $sql = "
     SELECT 
        sp.subject_id AS รหัสวิชา, 
        s.subject_name AS ชื่อวิชา, 
        s.num_credits AS หน่วยกิต, 
        sec.section_name AS 'Sec.', 
        sec.classroom AS ห้องเรียน, 
        sec.study_date AS วันที่เรียน, 
        sec.study_time AS เวลา, 
        t.name_sername AS ชื่อผู้สอน
    FROM 
        study_plan sp
    JOIN 
        subject s ON sp.subject_id = s.subject_id
    JOIN 
        section sec ON s.subject_id = sec.subject_id
    JOIN 
        teacher t ON sec.teacher_id = t.num_teacher
    WHERE 
        sec.class_id = '$class_id' 
        AND s.major_id = '$major_id'
        AND sp.semester = '$semester' 
        AND sp.school_year = '$schoolYear';     
    ";

    $stmt = $condb->prepare($sql);
    $stmt->execute();
    $courses = $stmt->fetchAll(PDO::FETCH_ASSOC);

    echo json_encode($courses);

} catch (PDOException $e) {
    echo json_encode(['error' => $e->getMessage()]);
}
?>
